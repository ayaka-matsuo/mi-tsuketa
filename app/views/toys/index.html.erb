<%= render 'layouts/header' %>


<div class="container">
	<h2>口コミする商品をお選び下さい</h2><br>

		<div class="col-md-12 searchfield">

			<%= form_tag(toys_path, :method => "get") do %>
			 <%= text_field_tag :search, placeholder='商品名・メーカー名を入力してください' %>
			<%= submit_tag "検索" ,:name => nil ,class: "button is-info"%>
			<% end %>
		</div>

		<div class="col-md-12 searchfield">

			<br><br><br>

			<div>
				<% @toys.each do |toy| %>
				<div class="col-md-3 toy-index">
					<div class="panel panel-default">

						<div class="panel-heading text-center">
							<%= link_to toy_path(toy.id) do %>
							<%= attachment_image_tag toy, :toy_image, format: 'jpeg', size: "200x200", fallback: "no_image.jpg" %>
							<% end %>
						</div>

						<div class="panel-body">
							<p class="product-brand"><%= toy.manufacturer %></p>
							<p class="product-title"><%= toy.name %></p>
								<div id="star-rate-<%= toy.id %>">口コミ
									<%= link_to toy_path(toy.id) do %>
										<%= toy.reviews.count %>
								<% end %>
								件 &nbsp;</div>
							<script>
								$('#star-rate-<%= toy.id %>').raty({
									size: 36,
							        starOff:  '<%= asset_path('star-off.png') %>',
							        starOn : '<%= asset_path('star-on.png') %>',
							        starHalf: '<%= asset_path('star-half.png') %>',
							        half: true,
							        readOnly: true,
							        score: <%= toy.reviews.average(:rate).to_f.round(1) %>,
							    });
							</script>
							<%= toy.reviews.average(:rate).to_f.round(1) %>点
							<%= link_to '口コミする',  new_toy_review_path(toy), class: 'btn btn-primary botan', data: {"turbolinks" => false} %>
						</div>

						<div class="panel-footer">

								<% if toy.toyfavorited_by?(current_user) %>
				                  <%= link_to toy_toyfavorites_path(toy), method: :delete do %>
				                  	<i class="fa fa-heart" aria-hidden="true" style="color: red;"></i>
				                  <% end %>
				                <% else %>
				                  <%= link_to toy_toyfavorites_path(toy), method: :post do %>
				                  	<i class="far fa-heart"></i>
				                  <% end %>
								<% end %>
								  <%= toy.toyfavorites.count %>
						</div>
					</div>
				</div>
				<% end %>
			</div>
		</div>
</div>