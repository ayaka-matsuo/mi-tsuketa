<%= render 'layouts/header' %>


<div class="cover">
	<div class="covercontain">
		<h2>おもちゃのレビューサイト</h2><br>
		<h4>ープレゼント選びの参考に！ー</h4>
	</div>
</div>

<div class="container">


	<!-- <div class="features">
		<div class="container">
			<div class="section-title text-center">
				<h1 class="title" style="font-weight: bold">み〜つけた！の特徴と使い方？</h1><br>
				<h4 class="title">おもちゃ選びで失敗したくない人のための口コミ共有サイト兼お子様の成長を記録できるサイト<br>
				み〜つけた！は「皆様により良いおもちゃ選びをお手伝いする」、こどものおもちゃの口コミサイトです。
				ネットでおもちゃ探しをする際に起こりがちな「想像とは違うおもちゃだった」というような失敗をなくすため（仮文です）
				</h4><br><br>
			</div>
			<div class="row">
				<div class="col-md-4 col-sm-6 feature text-center">
					<span aria-hidden="true" class="glyphicon glyphicon-check" style="font-size: 40px"></span>
					<h3 class="feature-title">リアルな口コミ</h3>
					<p>✔	口コミに実際におもちゃを使ったお子様の特徴が書かれているので、一人ひとりにあったおもちゃ選びができます。（仮分です）</p>
				</div>
				<div class="col-md-4 col-sm-6 feature text-center">
					<span aria-hidden="true" class="glyphicon glyphicon-zoom-in" style="font-size: 40px"></span>
					<h3 class="feature-title">おもいで機能</h3>
					<p>✔	変更したお子様の成長の変化を記録することができます（仮分です）</p>
				</div>
				<div class="col-md-4 col-sm-6 feature text-center">
					<span aria-hidden="true" class="glyphicon glyphicon-thumbs-up" style="font-size: 40px"></span>
					<h3 class="feature-title">ランキング</h3>
					<p>✔	最新の口コミのランキングからトレンドをピックアップできます（仮分です）</p>
				</div>
			</div>
		</div>
	</div> -->

<div>
	<h3 class="topsearch">口コミを探す</h3>

		<div class="col-md-12 searchfield">

			<%= form_tag(toys_path, :method => "get") do %>
			 <%= text_field_tag :search, '', placeholder: 'キーワードを入力して下さい', :size=>"40x100" %>
			<%= submit_tag "検索" ,:name => nil ,class: "btn-info"%>
			<% end %>
		</div>
</div>



</div>

<br><br><br>

<div class="container">
<h3 class="toy_select"><i class="fas fa-crown" style="color: #F8C758"></i>　口コミランキング　<i class="fas fa-crown" style="color: #F8C758"></i></h3><br>

<div>
	<% lastranktoy = 0 %>
  	<% j = 1 %>
	<% @toys.each.with_index(1) do |toy, i| %>
		<% if i == 1 %>
		<% lastranktoy = toy.reviews.average(:rate).to_f.round(1) %>
	    <% end %>
	    <% if toy.reviews.average(:rate).to_f.round(1) != lastranktoy %>
	    <% j = i %>
	    <% lastranktoy = toy.reviews.average(:rate).to_f.round(1) %>
	    <% else %>
	    <% lastranktoy = toy.reviews.average(:rate).to_f.round(1) %>
	    <% end %>
	<div class="col-md-3 toy-index">
					<div class="panel panel-default">
					<div class="panel-body">
						<div class="panel-body">
							<p>第<%= j %>位</p><br>
							<p class="product-brand"><%= toy.manufacturer %></p>
							<p class="product-title"><%= toy.name %></p>
								<div id="star-rate-<%= toy.id %>">
									<%= link_to toy_path(toy.id) do %>
										<%= attachment_image_tag toy, :toy1_image, format: 'jpeg', size: "200x200", fallback: "no_image.jpg" %>
									<% end %><br>
								 &nbsp;
								</div>
							<script>
								$('#star-rate-<%= toy.id %>').raty({
									size: 36,
							        starOff:  '<%= asset_path('star-off.png') %>',
							        starOn : '<%= asset_path('star-on.png') %>',
							        starHalf: '<%= asset_path('star-half.png') %>',
							        half: true,
							        readOnly: true,
							        score: <%= toy.reviews.average(:rate).to_f.round(1) %>,
							    });
							</script>
							<p><%= toy.reviews.average(:rate).to_f.round(1) %>点</p>
							口コミ数：<%= link_to toy_path(toy.id) do %>
									<%= toy.reviews.count %>
							<% end %>
						</div>

						<% if user_signed_in? %>
						<div class="panel-footer">

									<% if toy.toyfavorited_by?(current_user) %>
					                  <%= link_to toy_toyfavorites_path(toy), method: :delete do %>
					                  	<i class="fa fa-heart" aria-hidden="true" style="color: red;"></i>
					                  <% end %>
					                <% else %>
					                  <%= link_to toy_toyfavorites_path(toy), method: :post do %>
					                  	<i class="far fa-heart"></i>
					                  <% end %>
									<% end %>
								  	<%= toy.toyfavorites.count %>
						</div>
						<% end %>
					</div>
				</div>
		</div>
	<% end %>
</div>
</div>

