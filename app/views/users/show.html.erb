<%= render 'layouts/header' %>

<div class="container">

<div class="breadcrumbs">
	<%= link_to root_path do %>
		<%= "Home" %>
	<% end %>
	<%= ">" %>
	<span class="current">マイページ</span>
</div>



	<h3 class="toy_select">マイページ</h3><br>

		<div class="row">
			<div class="col-md-3">
					<div class="prof-area">

						<%= render 'layouts/profile', user: @user %>

					<%= link_to '編集する', edit_user_path(@user), class: 'btn btn-primary col-md-offset-2 col-md-6', data: {"turbolinks" => false} %><br>
					</div>

			</div>

			<div class="col-md-6">
				<div class="row">
					<div class="mypagetitle">
					<h4><%= @user.name %>さんの最近の口コミ</h4>
					</div>
							<% @user.reviews.last(1).each do |review| %>
							<% if review.present? %>

							<div>
								<div class="mypagecontent">
								<div class="col-md-12 review-toy">
									<div class="reviewscontent">
										<div class="reviewscontenthead">
											<p class="reviewday"><%= review.created_at.strftime('%Y/%m/%d') %></p>
											<p class="mypagereview">使用したお子様の情報:
											<%= review.child.age_year %>歳<%= review.child.age_month %>ヶ月 |
											<%= review.child.temperaments.pluck(:name).join(",") %>
											</p>
										</div><br>
										<div class="col-md-5 reviewstoy">
											<%= link_to toy_path(review.toy.id) do %>
												<%= attachment_image_tag review.toy, :toy1_image, format: 'jpeg', size: "100x100", fallback: "no_image.jpg" %><br>
											<% end %>
											<p class="mypagereview"><%= review.toy.name %></p><br>
										</div>
										<div class="col-md-7 mypagereviewcontain">
							         <!--星評価-->
									         <div id="star-rate-<%= review.id %>"><%= review.rate %><%="　"%></div>
									          <script>
									          $('#star-rate-<%= review.id %>').raty({
									            size: 36,
									            starOff:  '<%= asset_path('star-off.png') %>',
									            starOn : '<%= asset_path('star-on.png') %>',
									            starHalf: '<%= asset_path('star-half.png') %>',
									            half: true,
									            readOnly: true,
									            score: <%= review.rate %>,
									          });
									          </script>
					        				<!--/星評価-->
					        				<br><br><br><%= review.body %>
										</div>
									</div>
								</div>
								</div>
								<div class="centerbtn">
									<%= link_to 'もっと見る', root_path, class: 'btn btn-primary', data: {"turbolinks" => false} %>
								</div>
							</div>
						<% else %>
						<div>
							<div class="mypagecontent">
								<%= 投稿がまだありません %>
							</div>
						</div>
						<% end %>
					<% end %>
				</div>

				<div class="row">
					<div class="mypagetitle">
						<h4>いいねした商品</h4>
					</div>

						<div>
							<div class="mypagecontent">

								<% @user.liked_toys.each do |toy| %>
								<div class="col-md-3 toy-index">
									<div class="panel panel-default">

										<div class="panel-heading text-center">
											<%= link_to toy_path(toy.id) do %>
											<%= attachment_image_tag toy, :toy1_image, format: 'jpeg', size: "200x200", fallback: "no_image.jpg" %>
											<% end %>
										</div>

										<div class="panel-body">
											<p class="product-brand"><%= toy.manufacturer %></p>
											<p class="product-title">
												<%= link_to toy_path(toy.id) do %>
													<%= toy.name %>
												<% end %>
											</p>
												<div id="star-rate-<%= toy.id %>"></div>
													<p class="product-review">口コミ
														<%= link_to toy_path(toy.id) do %>
															<%= toy.reviews.count %>
														<% end %>
												件 &nbsp;
													</p>
											<script>
												$('#star-rate-<%= toy.id %>').raty({
													size: 36,
											        starOff:  '<%= asset_path('star-off.png') %>',
											        starOn : '<%= asset_path('star-on.png') %>',
											        starHalf: '<%= asset_path('star-half.png') %>',
											        half: true,
											        readOnly: true,
											        score: <%= toy.reviews.average(:rate).to_f.round(1) %>,
											    });
											</script>
										</div>

										<div class="panel-footer">

												<% if toy.toyfavorited_by?(current_user) %>
								                  <%= link_to toy_toyfavorites_path(toy), method: :delete do %>
								                  	<i class="fa fa-heart" aria-hidden="true" style="color: red;"></i>
								                  <% end %>
								                <% else %>
								                  <%= link_to toy_toyfavorites_path(toy), method: :post do %>
								                  	<i class="far fa-heart"></i>
								                  <% end %>
												<% end %>
												  <%= toy.toyfavorites.count %>
										</div>
									</div>
								</div>
								<% end %>
							</div>
						</div>
				</div>

			<div class="row">
					<div class="mypagetitle">
						<h4>いいねした口コミ</h4>
					</div>

					<div>
							<div class="mypagecontent">

								<% @user.liked_reviews.each do |review| %>

									<div>
										<div class="col-md-3 review-toy">
											<%= attachment_image_tag review.user, :profile_image, format: 'jpeg', size: "100x100", fallback: "no_image.jpg" %><br>
											<%= review.user.name %>さん
										</div>
										<div class="col-md-9 review-toy">
											<div class="reviewscontent">
												<div class="reviewscontenthead">
													<p class="reviewday"><%= review.created_at.strftime('%Y/%m/%d') %></p>
													使用したお子様の情報:
													<%= review.child.age_year %>歳<%= review.child.age_month %>ヶ月 |
													<%= review.child.temperaments.pluck(:name).join(",") %>
												</div><br>
												<div class="col-md-4 reviewstoy">
													<%= link_to toy_path(review.toy.id) do %>
														<%= attachment_image_tag review.toy, :toy1_image, format: 'jpeg', size: "100x100", fallback: "no_image.jpg" %><br>
													<% end %>
													<%= review.toy.name %><br>
												</div>
												<div class="col-md-8">
									         <!--星評価-->
											         <div id="star-rate-<%= review.id %>"><%= review.rate %><%="　"%></div>
											          <script>
											          $('#star-rate-<%= review.id %>').raty({
											            size: 36,
											            starOff:  '<%= asset_path('star-off.png') %>',
											            starOn : '<%= asset_path('star-on.png') %>',
											            starHalf: '<%= asset_path('star-half.png') %>',
											            half: true,
											            readOnly: true,
											            score: <%= review.rate %>,
											          });
											          </script>
							        				<!--/星評価-->
							        				<%= review.body %>
												</div>
											</div>
										</div>
									</div>
								<% end %>
							</div>
					</div>
			</div>
		</div>

		<div class="col-md-3">
				<div class="row">
					<h4 class="mypagetitle">登録済みのお子様</h4>
					<% @user.children.last(2).each do |child| %>

						<div class="mypagechild">
							<%= link_to edit_child_path(child.id) do %>
								<%= attachment_image_tag child, :profile_image, format: 'jpeg', size: "100x100", fallback: "no_image.jpg" %>
							<% end %>
							<%= child.name %><br>
							<%= child.temperaments.pluck(:name).join("/") %>
						</div>
					<% end %>
					<%= link_to 'もっと見る', children_path(@user), class: 'btn btn-primary col-md-offset-3 col-md-6', data: {"turbolinks" => false} %>
					<%= link_to 'お子様を登録する', new_child_path, class: 'btn btn-primary col-md-offset-3 col-md-6', data: {"turbolinks" => false} %>
				</div>

				<br>
				<br>

				<div class="row">
					<h4 class="mypagetitle">最近のおもいで</h4>
					<% @user.child_archives.last(2).each do |child_archive| %>

					<div class="mypagechild">
						<%= link_to edit_child_archive_path(child_archive.id) do %>
							<%= attachment_image_tag child_archive, :profile_image, format: 'jpeg', size: "100x100", fallback: "no_image.jpg" %>
						<% end %>
						<%= child_archive.created_at.strftime('%Y/%m/%d') %><br>
						<%= child_archive.child.name %><br>
					</div>
					<% end %>
					<%= link_to 'もっと見る', child_archives_path(@user), class: 'btn btn-primary col-md-offset-3 col-md-6', data: {"turbolinks" => false} %>
					<%= link_to 'おもいでを登録する', new_child_archive_path, class: 'btn btn-primary col-md-offset-3 col-md-6', data: {"turbolinks" => false} %>
				</div>
		</div>
	</div>
</div>



